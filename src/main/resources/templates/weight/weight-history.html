<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="kr">
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>위더스</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
	<meta name="format-detection" content="telephone=no">
	<link  th:href="@{/css/jquery-ui.css}" rel="stylesheet">
	<link th:href="@{/css/reset.css}" rel="stylesheet">
	<link th:href="@{/css/common.css}" rel="stylesheet">
	<link th:href="@{/css/layout.css}" rel="stylesheet">
	<script th:src="@{/js/jquery-1.12.4.min.js}"></script>
	<script th:src="@{/js/jquery-ui.js}"></script>
	<script th:src="@{/js/datepicker-ko.js}"></script>
	<script th:src="@{/js/chart.js}"></script>
	<script th:src="@{js/chartjs-plugin-style.min.js}"></script>
	<script th:src="@{/js/common.js}"></script>
	<script th:src="@{/js/help.js}"></script>
</head>
<body>
<input type="hidden" id="button-count" th:attr="value=@{/button-count}">
<input type="hidden" id="helper-request" th:attr="value=@{/helper-request}">
<div class="skip-navi">
	<a href="#content">본문 바로가기</a>
</div>
<div th:if="${type} == ${T(withus.entity.User.Type).PATIENT} and ${week} != 25 ">
	<input type = 'hidden' name = "symptom"           th:value = "${count.symptom}" style = "display:none">
	<input type = 'hidden' name = "alarm"             th:value = "${count.alarm}" style = "display:none">
	<input type = 'hidden' name = "blood"             th:value = "${count.bloodPressure}" style = "display:none">
	<input type = 'hidden' name = "disease"           th:value = "${count.diseaseInfo}" style = "display:none">
	<input type = 'hidden' name = "exercise"          th:value = "${count.exercise}" style = "display:none">
	<input type = 'hidden' name = "goal"              th:value = "${count.goal}" style = "display:none">
	<input type = 'hidden' name = "helper"            th:value = "${count.helper}" style = "display:none">
	<input type = 'hidden' name = "level"             th:value = "${count.level}" style = "display:none">
	<input type = 'hidden' name = "natriumMoisture"   th:value = "${count.natriumMoisture}" style = "display:none">
	<input type = 'hidden' name = "weight"            th:value = "${count.weight}" style = "display:none">
	<input type = 'hidden' name = "withusRang"        th:value = "${count.withusRang}" style = "display:none">
</div>
<!-- wrap -->
<div id="wrap" class="chart-page">

	<!-- header -->
	<header>
		<div class="header-wrap type01">
			<div class="head" th:if="${type} == ${T(withus.entity.User.Type).PATIENT} and ${week} != 25 ">
				<div onclick="helperRequest()" >
					<a class="btn xsm type07" href="tel:010-8454-9186" th:onclick="'addHelper(parseInt(' + ${count.helper} + '))'" >
						<span class="ico-call" ></span>
						<span class="txt-rt">도우미</span>
					</a>
				</div>
				<h2>
					<span class="ico-weight-s"></span>
					<span>체중 변화</span>
				</h2>
			</div>
			<div class="head" th:if="${type} == ${T(withus.entity.User.Type).CAREGIVER} or ${week} == 25">
				<div onclick="helperRequest()" >
					<a class="btn xsm type07" href="tel:010-8454-9186">
						<span class="ico-call" ></span>
						<span class="txt-rt">도우미</span>
					</a>
				</div>
				<h2>
					<span class="ico-weight-s"></span>
					<span>체중 변화</span>
				</h2>
			</div>
		</div>
	</header>
	<!-- // header -->

	<!-- content -->
	<div class="container" id="content">
		<div class="cont-wrap type01">
			<div id="dateRecord" class="size-lg"></div>
			<div class="chart-wrap">
				<div class="chart-legend">
					<span class="tit">Kg</span>
					<ul class="list">
						<li class="green">체중</li>
					</ul>
				</div>
				<canvas id="myChart" class="chart-blood" style="height:90vw; width:100vw"></canvas>
				<div class="chart-legend">
					<span class="tit"></span>
					<ul class="list">
						<li >(일)</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<!-- // content -->

</div>
<!--// wrap -->

<script th:inline="javascript">

	$.datepicker._generateHTML = (function (){
		var realGenerateHtml = $.datepicker._generateHTML;
		return function (instance) {
			var html = realGenerateHtml.apply(this, arguments), $temp;

			if ( instance.input.is(".size-lg") ) {
				$temp = $("<table></table>").append(html);
				$temp.find(".ui-datepicker-title").each(function () {

					var year = $(this).find('.ui-datepicker-year').text();
					var month = $(this).find('.ui-datepicker-month').text();
					var str = year + "-" + month;

					/*<![CDATA[*/
					var weightRecord = /*[[ ${weightRecord} ]]*/;
					/*]]*/

					var date = [];
					var weight = [];
					var j = 0;
					for(i=0; i<weightRecord.length; i++)
					{
						if(str == weightRecord[i].pk.date.substr(0, 7))
						{
							date[j] = weightRecord[i].pk.date.substr(8, 2);
							weight[j] = weightRecord[i].weight;
							j++;
						}
					}

					let draw = Chart.controllers.line.prototype.draw;
					var ctx = document.getElementById('myChart').getContext('2d');
					var data = {
						labels: date,
						datasets: [{
							label: '체중',
							data: weight,
							fill: true,
							spanGaps: false,
							borderWidth: 2,
							borderColor: '#21bc97',
							pointBackgroundColor: '#21bc97',
							pointBorderColor: '#21bc97',
							pointRadius: 1.5
						}]
					};

					var myChart = new Chart(ctx, {
						plugins: [
							{
								id: "responsiveGradient",
								afterLayout: function(chart, options) {
									var scales = chart.scales;

									// create a linear gradient with the dimentions of the scale
									var color = chart.ctx.createLinearGradient(0,scales["y-axis-0"].bottom,0,0);
									// add gradients stops
									color.addColorStop(0, "rgba(33,188,151,0)");
									color.addColorStop(0.25, "rgba(33,188,151,0)");
									color.addColorStop(0.5, "rgba(33,188,151,0)");
									color.addColorStop(0.75, "rgba(33,188,151,0.1)");
									color.addColorStop(1, "rgba(33,188,151,0.7)");

									// changes the background color option
									chart.data.datasets[0].backgroundColor = color;
								}
							}
						],

						// The type of chart we want to create
						type: 'line',

						// The data for our dataset
						data: data,

						// Configuration options go here
						options: {
							scales:{
								yAxes:[{
									ticks: {
										beginAtZero: true,
										min: 30,
										max: 110,
										stepSize: 10,
										maxTicksLimit: 20,
										callback: function(value, index, values) {
											return value == 30 || value == 50 || value == 70 || value == 90 ||  value == 110?value:'';
										}
									}
								}]
								,
								xAxes:[{
									gridLines: {
										display: false
									}
								}]
							},
							legend: {
								display: false,
								position: 'top',
								align: 'right', // 안먹음 ㅠㅠ
								fullWidth: false,
								labels: {
									usePointStyle: true,
									fontSize: 13,
									fontStyle: '',
									padding: 30
								}
							}
						}
					});
				});
				html = $temp[0].innerHTML;
			}

			return html;
		};
	})();


	$( function() {
		$( "#dateRecord" ).datepicker({

		});
	} );


</script>

</body>
</html>
