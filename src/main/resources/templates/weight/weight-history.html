<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="kr">
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>위더스</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
	<meta name="format-detection" content="telephone=no">
	<link  th:href="@{/css/jquery-ui.css}" rel="stylesheet">
	<link th:href="@{/css/reset.css}" rel="stylesheet">
	<link th:href="@{/css/common.css}" rel="stylesheet">
	<link th:href="@{/css/layout.css}" rel="stylesheet">
	<script th:src="@{/js/jquery-1.12.4.min.js}"></script>
	<script th:src="@{/js/chart.js}"></script>
	<script th:src="@{js/chartjs-plugin-style.min.js}"></script>
	<script th:src="@{/js/jquery-ui.js}"></script>
	<script th:src="@{/js/datepicker-ko.js}"></script>
	<script th:src="@{/js/common.js}"></script>
</head>
<body>
<div class="skip-navi">
	<a href="#content">본문 바로가기</a>
</div>
<!-- wrap -->
<div id="wrap" class="chart-page">

	<!-- header -->
	<header>
		<div class="header-wrap type01">
			<div class="head">
				<a class="btn xsm type07" href="tel:02-820-5198">
					<span class="ico-call"></span>
					<span class="txt-rt">도우미</span>
				</a>
				<h2>
					<span class="ico-weight-s"></span>
					<span>체중 변화</span>
				</h2>
			</div>
		</div>
	</header>
	<!-- // header -->

	<!-- content -->
	<div class="container" id="content">
		<div class="cont-wrap type01">
			<div id="dateRecord" class="size-lg"></div>
			<div class="chart-wrap">
				<div class="chart-legend">
					<span class="tit">Kg</span>
					<ul class="list">
						<li class="green">체중</li>
					</ul>
				</div>
				<canvas id="myChart" class="chart-blood" style="height:90vw; width:100vw"></canvas>
			</div>
		</div>
	</div>
	<!-- // content -->

</div>
<!--// wrap -->

<script th:inline="javascript">

	/*<![CDATA[*/
	var weightRecord = /*[[ ${weightRecord} ]]*/;
	/*]]*/

	var date = [];
	var weight = [];
	for(i=0; i<weightRecord.length; i++)
	{
		date[i] = weightRecord[i].pk.date;
		weight[i] = weightRecord[i].weight;
	}

	$.datepicker._generateHTML = (function (){
		var realGenerateHtml = $.datepicker._generateHTML;
		return function (instance) {
			var html = realGenerateHtml.apply(this, arguments), $temp;

			if ( instance.input.is(".size-lg") ) {
				$temp = $("<table></table>").append(html);
				$temp.find(".ui-datepicker-calendar").each(function () {
					var yy = $(this).parent().data("year"),
							mm = $(this).parent().data("month");

					var jsDate = $('#dateRecord').datepicker('getDate');
					var year = jsDate.getFullYear();
					var month = jsDate.getMonth() + 1;

					if(month.toString().length == 1){
						month = "0" + month;
					}

					var str = year + "-" + month;

					console.log(str);

				});
				html = $temp[0].innerHTML;
			}

			$(".ui-datepicker-next").click(function (){
				console.log("다음달 클릭");
			});
			return html;
		};
	})();

	$( function() {
		$( "#dateRecord" ).datepicker({

		});

		// var jsDate = $('#dateRecord').datepicker('getDate');
		// var year = jsDate.getFullYear();
		// var month = jsDate.getMonth() + 1;
		//
		// if(month.toString().length == 1){
		// 	month = "0" + month;
		// }
		//
		// var str = year + "-" + month;
		//
		// console.log(str);
	} );


	let draw = Chart.controllers.line.prototype.draw;
	var ctx = document.getElementById('myChart').getContext('2d');
	var data = {
		labels: date,
		datasets: [{
			label: '체중',
			data: weight,
			fill: true,
			spanGaps: false,
			borderWidth: 2,
			borderColor: '#21bc97',
			pointBackgroundColor: '#21bc97',
			pointBorderColor: '#21bc97',
			pointRadius: 1.5
		}]
	};

	var myChart = new Chart(ctx, {
		plugins: [
			{
				id: "responsiveGradient",
				afterLayout: function(chart, options) {
					var scales = chart.scales;

					// create a linear gradient with the dimentions of the scale
					var color = chart.ctx.createLinearGradient(0,scales["y-axis-0"].bottom,0,0);
					// add gradients stops
					color.addColorStop(0, "rgba(33,188,151,0)");
					color.addColorStop(0.25, "rgba(33,188,151,0)");
					color.addColorStop(0.5, "rgba(33,188,151,0)");
					color.addColorStop(0.75, "rgba(33,188,151,0.1)");
					color.addColorStop(1, "rgba(33,188,151,0.7)");

					// changes the background color option
					chart.data.datasets[0].backgroundColor = color;
				}
			}
		],

		// The type of chart we want to create
		type: 'line',

		// The data for our dataset
		data: data,

		// Configuration options go here
		options: {
			scales:{
				yAxes:[{
					ticks: {
						beginAtZero: true,
						min: 0,
						max: 100,
						stepSize: 10,
						maxTicksLimit: 20,
						callback: function(value, index, values) {
							return value == 0 || value == 20 || value == 40 || value == 60 ||  value == 80 || value == 100?value:'';
						}
					}
				}]
				,
				xAxes:[{
					gridLines: {
						display: false
					}
				}]
			},
			legend: {
				display: false,
				position: 'top',
				align: 'right', // 안먹음 ㅠㅠ
				fullWidth: false,
				labels: {
					usePointStyle: true,
					fontSize: 13,
					fontStyle: '',
					padding: 30
				}
			}
		}
	});
</script>

</body>
</html>
